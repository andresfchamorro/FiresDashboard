<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link
      rel="stylesheet"
      href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"
  />
  <style>
@font-face {
    font-family: "Arial MT Std";
    src: url(http://gfw2-data.s3.amazonaws.com/fires/d3/Dashboard/ArialMTStd-LightCond.otf) format("opentype");
    font-weight: normal;
}
@font-face {
    font-family: "Arial MT Std";
    src: url(http://gfw2-data.s3.amazonaws.com/fires/d3/Dashboard/ArialMTStd-BoldCond.otf) format("opentype");
    font-weight: bold;
}
body {
  font-family: "Arial MT Std", Helvetica, sans-serif, Arial;
  position: relative;
}
h1{
  color: #424242;
  font-size: 18px;
  margin: 5px;
  text-align: center;
  text-transform: uppercase;
  letter-spacing: 1px;
}
h2{
  color: #424242;
  font-size: 16px;
  margin: 0px;
  text-align: center;
  font-weight: bolder;
}
h3{
  display: block;
  font-size: 16px;
  margin: 15px;
  font-weight: normal;
}
h4{
  display: block;
  margin: 0px;
  text-align: center;
  font-weight: normal;
  font-size: 14px;
}
h5{
  display: inline;
  margin: 0px;
  text-align: center;
  font-weight: normal;
  font-size: 14px;
}

.background {
  fill: none;
  pointer-events: all;
}
.mesh {
  fill: none;
  stroke: #fff;
  stroke-linecap: round;
  stroke-linejoin: round;
}
.axis path,
.axis line {
  fill: none;
  stroke: darkgray;
  stroke-width: 1;
  shape-rendering: crispEdges;
}
.axis text {
  font-size: 11px;
}
#info{
  z-index: 1;
  position:relative;
  width:200px;
  height:80px;
  padding:10px;
  background-color:transparent;
  border-radius:10px;
  margin-left: 10px;
  /*box-shadow: 4px 4px 10px rgba(0,0,0,0.1);*/
}
#info2 {
  width: 80px;
  overflow: hidden;
  float: left;
}
#info2 h2 {
  font-size: 24px;
  text-align: right;
  margin-top: 5px;
}

#info3 {
  width: 110px;
  overflow: hidden;
}
#info3 h2 {
}
#info.hidden{
  display:none;
}
#info p{
  margin:0px;
  font-size:12px;
}
p {
  text-align: left;
}
.line {
				stroke:#D68178;
				stroke-width: 1;
				fill: none;
			}
#chartDiv rect{
  fill:#D68178;
}
#chartDiv rect.selected{
  fill:darkred;
}
#chartDiv svg {
}

#box {
  overflow: hidden;
  margin: auto;
}
#box div{
    display: inline-block;
}
#mapDiv {
  margin: auto;
  width: 550px;
  height: 250px;
  border: 1px dashed darkgray;
}

#chartDiv {
  margin: auto;
  width: 650px;
}

#pieDiv1 path {
  stroke: #fff;
}
#pieDiv1 text {
	font-size: 10px;
  fill:white;
}
#pieDiv2 path {
  stroke: #fff;
}
#pieDiv2 text {
	font-size: 10px;
  fill:white;
}
#barChart text {
  font-size: 10px;
  fill:black;
}
#dashboard{
  overflow: hidden;
  margin: auto;
  width: 650px;
}
#left{
  width: 550px;
  float: left;
}
#right{
  overflow: hidden;
  margin: auto;
  width: 600px;
}
#right div{
    display: inline-block;
}
#right svg {
  margin: auto;
}
#pieDiv2 {
  float: right;
}
.indent {
  margin-left: 50px;
  margin-right: 50px;
}
.shorter {
  width: 450px;
}


  </style>
</head>
<body>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://d3js.org/topojson.v1.min.js"></script>
  <script src="http://d3js.org/d3-tile.v0.0.min.js"></script>
  <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/leaflet.esri/1.0.4/esri-leaflet.js"></script>
  <script>
    // Copyright (c) 2013 Ryan Clark
    // https://gist.github.com/rclark/5779673
    L.TopoJSON = L.GeoJSON.extend({
      addData: function(jsonData) {
        if (jsonData.type === "Topology") {
          for (key in jsonData.objects) {
            geojson = topojson.feature(jsonData, jsonData.objects[key]);
            L.GeoJSON.prototype.addData.call(this, geojson);
          }
        }
        else {
          L.GeoJSON.prototype.addData.call(this, jsonData);
        }
      }
    });
  </script>

<div id="dashboard">
    <h1>Indonesia's Fire History Provides Insights to Prevent Future Fires</h1>
    <p>For decades, forest and land fires in Indonesia have become an annual environmental crisis. The fires are set to clear the country's moist tropicla forest and make way for pulpwood and oil palm plantations. The dry conditions brought by the 2015 El Niño made last year's fire season the worst in twenty years: approximately 2.6 millions hectares of land were burned between June and October. The fires, many burning on carbon-rich peatlands, exposed millions of people across Southeast Asia to toxic haze and tripled Indonesia's annual greenhouse gas emissions. This year we have not seen nearly as many fires because of wetter conditions, but the root of the problem still needs to be addressed.
    </p>
    <p>Nearly all fires in Indonesia are human-caused. Fires are typically set to clear land for agriculture, but also during land conflicts. While weather conditions dictate when fires can burn – Indonesia typically experiences two annual dry seasons, human actions determine where fires occur each year, with the highest concentration of fires occurring in areas with the greatest amount of forest conversion to agriculture and where land claims are at odds with local communities. While the incentives to burn are threats to forests all across the country, fires are likely to continue happening in regions with a long history of land conversion and conflicts – where land-owners might seek to expand their plantations – as well as in regions with a recent spike in fires – where the new frontiers of burning have been set.
    </p>
    <p>Analyzing the past 15 years of fire data can help guide fire prevention efforts - like companies' no-burn commitments, government land use and restoration strategies, or village-level fire prevention programs - to the areas of greatest need.
    </p>
    <p>To address the need for historical insights, GFW fires has developed a series of data layers that show the yearly concentration of fire alerts detected by NASA's MODIS satellites. In the map below, hotter/redder areas symbolize a high concentration of fire alerts, while bluer/colder areas signal a lower occurrence of fires.
    </p>
    <div id="mapDiv"></div>
    <p>The fires in 2015 were densely concentrated in South Sumatra and Central Kalimantan, which are also the provinces with the highest amount of fires over the past 15 years. The graph below charts the continuing occurrence of fire alerts in Central Kalimantan (more than 30,000 alerts in 2006 and 2015). Click on any other province in the map to view the trend for that province. South Sumatra also shows a long history of fire activity, though not as high in intensity as Kalimantan.
    </p>
    <div id="chartDiv"></div>
      <p class="shorter">
        <div id="pieDiv2">
          <h4>Fire Alerts on <span style="color:#1B455E; font-weight:bold;">Peatland</span></h4>
        </div>
        What is driving the high frequency of fires in these two provinces? To begin with, they share a high concentration of flammable peatlands, which will not burn unless drained first, confirming the link between fires and agricultural expansion. In 2015, over 60% of fires in Central Kalimantan and South Sumatra were located in peatlands.
      </p>
    <p>When looking at what commodities are driving the fires, the answer varies across different provinces. The charts below add contextual information for fires in Central Kalimantan. Every year since 2001, the majority of alerts detected in this province were located inside oil palm plantations. The charts can be updated by clicking on another province, and hovering over a different year. In South Sumatra, the key commodities driving fires are pulpwood and wood fiber. Up to 50% of fire alerts from 2015 fell inside wood fiber concession areas.
    </p>
  <div id="right">
    <div id="pieDiv1">
      <h4>Fire Alerts in <span style="color:#1B5E48; font-weight:bold;">Protected Areas</span></h4>
    </div>
    <div id="barChart">
      <h4>Fires Alerts by Land Use Area</h4>
    </div>
  </div>
  <p>What is happening in other provinces? Although fires in Riau are decreasing, the fire alert count for 2016 is relatively high for a wet year, and almost half of these fire alerts were located inside wood fiber concessions. A new emerging fire hotspot is Papua, where illegal burning is starting to set off in relatively untouched forests. The high percentage of fire alerts detected inside protected areas in this province - more than 35% every year since 2001- is a big cause for concern.
  </p>
  <p>What efforts could be targeted to Kalimantan, Sumatra, Riau and Papua to prevent yet another fire crisis in Indonesia?
  </p>
  <p class="indent">1. No-burn and zero-deforestation commitments should be prioritized in provinces with chronic fires, where the clearing of forests and peatlands for agricultural expansion needs to be contained. Moreover, companies that have already announced such commitments need to deliver not only within their concession boundaries, but also develop strategies to ensure this commitment is followed across their entire supply chains.
  </p>
  <p class="indent">2. Provinces with intense recent burning, such as Papua, should be monitored closely. The new commitment to strengthen Indonesia's moratorium by including peatlands --
  </p>
  <p class="indent">3. Provinces with a long history of burning should be the main focus of the Peatland Restoration Agency, a new government-led effort to restore the hydrology of peatlands. The recent amendment to the moratorium also demands companies to restore peatlands they have drained in the past.
  </p>
  <p class="indent">4. More granular analysis of fire history can help decide where to up-scale village-level initiatives, such as the work of the Fire Free Alliance Village. The Alliance groups together different companies and non-governmental organization to develop patrolling, water management and fire prevention programs in specific villages in Riau.
  </p>
</div>

<script>

var tables = [];
var loadTables = function(){
  d3.csv("Tables/Adm1_2001.csv", function(error, data0) {
      tables.push(data0);
      d3.csv("Tables/Adm1_2002.csv", function(error, data1) {
        tables.push(data1);
        d3.csv("Tables/Adm1_2003.csv", function(error, data2) {
          tables.push(data2);
          d3.csv("Tables/Adm1_2004.csv", function(error, data3) {
            tables.push(data3);
            d3.csv("Tables/Adm1_2005.csv", function(error, data4) {
              tables.push(data4);
              d3.csv("Tables/Adm1_2006.csv", function(error, data5) {
                tables.push(data5);
                d3.csv("Tables/Adm1_2007.csv", function(error, data6) {
                  tables.push(data6);
                  d3.csv("Tables/Adm1_2008.csv", function(error, data7) {
                    tables.push(data7);
                    d3.csv("Tables/Adm1_2009.csv", function(error, data8) {
                      tables.push(data8);
                      d3.csv("Tables/Adm1_2010.csv", function(error, data9) {
                        tables.push(data9);
                        d3.csv("Tables/Adm1_2011.csv", function(error, data10) {
                          tables.push(data10);
                          d3.csv("Tables/Adm1_2012.csv", function(error, data11) {
                            tables.push(data11);
                            d3.csv("Tables/Adm1_2013.csv", function(error, data12) {
                              tables.push(data12);
                              d3.csv("Tables/Adm1_2014.csv", function(error, data13) {
                                tables.push(data13);
                                d3.csv("Tables/Adm1_2015.csv", function(error, data14) {
                                  tables.push(data14);
                                    d3.csv("Tables/Adm1_2016.csv", function(error, data15) {
                                      tables.push(data15);
      });
      });
      });
      });
      });
      });
      });
      });
      });
      });
      });
      });
      });
      });
      });
      });
}

var LineData = [];

var createMap = function(){

//Variables
  var active = d3.select("null");
  mapLink = '<a href="http://52.200.102.67/osm_tiles"></a>';

//Layers
  var gray = L.esri.basemapLayer("Gray",{opacity: 0.5});
  var kd2015 = L.tileLayer(
          'http://wri-tiles.s3.amazonaws.com/fires_idn/2015/{z}/{x}/{y}.png', {
          attribution: '&copy; ' + mapLink + ' Contributors',
          maxZoom: 22,
          });
  var kdAllYears = L.tileLayer(
          'http://wri-tiles.s3.amazonaws.com/fires_idn/all/{z}/{x}/{y}.png', {
          attribution: '&copy; ' + mapLink + ' Contributors',
          maxZoom: 22,
        });

  map = new L.map('mapDiv', {
            maxZoom:8,
            minZoom:4,
            center:[-3, 118],
            zoom: 4,
            layers: [gray, kd2015]
          });

  L.esri.basemapLayer("GrayLabels", {opacity: 0.5}).addTo(map).bringToFront();
  var overlayHeatmap = {
    "Heatmap: 2015": kd2015,
    "Heatmap: Last 15 Years": kdAllYears
  };

  L.control.layers(overlayHeatmap).addTo(map);

  var legend = L.control({position:'bottomleft'});
  legend.onAdd = function (map){
    var div = L.DomUtil.create('div', 'legend');
    div.innerHTML += '<img src="legend.png" alt="legend" >';
    return div;
  };
  legend.addTo(map);

  d3.json("toposim-IndonesiaFires2.json", function(json){

    function style(feature) {
      return {
        fillColor : 'transparent',
        fillOpacity: 1,
        color:'#555',
        weight:0.3,
        opacity:1
      };
    }

    var topoAdm1Data = topojson.feature(json, json.objects.IndonesiaFires);

    var topoAdm1 = new L.TopoJSON(topoAdm1Data, {style:style});
    topoAdm1.addTo(map);
    topoAdm1.eachLayer(handleLayer);


    function handleLayer(layer){

    //  layer.setStyle(style());

      layer.on({
        click : clicked,
        mouseover: hover,
        mouseout: reset
      });
    }

    function clicked(e) {
        //Change bar chart and also selected adm1 id
        var layer = e.target
        trendChart.updateTrendChart(layer.feature);
        selected_id = layer.feature.properties.ID;
        if (selected_year) {
          pies.updatePie(svgPie1,selected_id,selected_year,"Protected","OutProtected");
          pies.updatePie(svgPie2,selected_id,selected_year,"Peat","OutPeat");
          barChart.updateBarChart(selected_id, selected_year);
          var idname = "F" + (selected_year+2001);
          //update info
          var info = d3.select("#info");
          info.select("#number").text(formatLong(layer.feature.properties[idname]));
          /*
          info.select("#number").transition().duration(200)
            .tween("text", function(){
              var i = d3.interpolateRound(+this.textContent, layer.feature.properties[idname]);
              return function(t) {
                this.textContent = i(t);
              }
            });
            */
        }
        layer.setStyle({
          fillColor: 'rgba(145,145,145,0.2)',
          weight: 0.3,
        })
        map.fitBounds(layer.getBounds());
        //update info
        var info = d3.select("#info");
        info.select("#place").text(layer.feature.properties.NAME_1);
    }

    function hover(e) {
        var layer = e.target;
        layer.setStyle({
          fillColor: 'rgba(145,145,145,0.2)',
        });
    }
    function reset(e) {
      var layer = e.target;
      topoAdm1.resetStyle(layer);
    }

});
}

var createTrendChart = function(){

  //Trend chart variables
  var width = 600, height = 250;
  var margins = {top: 15, right: 20, bottom: 40, left: 100};
  var chartwidth = width - margins.left - margins.right;
  var chartheight = height - margins.top - margins.bottom;
  var years = [2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016];
  var svgChartArea = d3.select("#chartDiv")
                  .append("svg")
                  .attr("width", width)
                  .attr("height", height);
  var chart = svgChartArea.append("g")
                .attr("transform","translate("+margins.left + "," + margins.top + ")");
  var dataset = [20000,2220,2130,3323,12323,2323,12325,3535,55,75650,0,0,0,0,0,0];
  //Scales
  var xScaleLinear = d3.scale.linear().domain([2001,2016]).range([0, chartwidth]);
/*
  var xScale = d3.scale.ordinal()
                .domain(d3.range(2001,2017))
                .rangeRoundBands([0,chartwidth],0.4);
*/
  var yScale = d3.scale.linear()
                .domain([0, 30000])
                .range([chartheight, 0]);
  //Define x,y axis
  var xAxisLine = d3.svg.axis().scale(xScaleLinear).orient("bottom").ticks(16);

  var line = d3.svg.line()
    .x(function(d,i) {
      return xScaleLinear(i+2001);
    })
    .y(function(d){
      return yScale(d);
    })

/*
  var xAxis = d3.svg.axis()
          .scale(xScale)
          .orient("bottom")
          .ticks(16);
*/

  var yAxis = d3.svg.axis()
          .scale(yScale)
          .orient("left")
          .ticks(7);

  //Create bar chart
  var drawChart = function(){
    chart.append("path").attr("class", "line").attr("d", line(dataset));
    chart.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + (chartheight) + ")")
        .call(xAxisLine);
    chart.append("g")
        .attr("class", "y axis")
        .call(yAxis);
    }

  drawChart.updateTrendChart = function(selected_data){
    //var test = d3.values(selected_data); More efficient?
    dataset = [selected_data.properties.F2001,selected_data.properties.F2002,selected_data.properties.F2003,selected_data.properties.F2004,selected_data.properties.F2005,selected_data.properties.F2006,selected_data.properties.F2007,selected_data.properties.F2008,selected_data.properties.F2009,selected_data.properties.F2010,selected_data.properties.F2011,selected_data.properties.F2012,selected_data.properties.F2013,selected_data.properties.F2014,selected_data.properties.F2015,selected_data.properties.F2016];

    //yScale.domain([0, d3.max(dataset)])

    chart.selectAll("rect")
      .data(dataset)
      .transition()
      .duration(750)
      .attr("x", function(d, i){
        return xScaleLinear(2001+i);
      })
      .attr("y", function(d){
        return yScale(d);
      })
      .attr("width", xScaleLinear.rangeBand())
      .attr("height", function(d){
        return chartheight - yScale(d);
      });

    //Update Y axis
    chart.select(".y.axis")
        .transition()
        .duration(750)
      .call(yAxis);
    };
  drawChart();
  return drawChart;
}

var formatLong = d3.format(",d");
//Tables and variables for pie charts
var mockdataset = [0,50];
var selected_id, selected_year;
var pie_w = 150, pie_h = 150;
//var pie_margins = {top: 10, right: 10, bottom: 0, left: 10};
var pie = d3.layout.pie().sort(null);
var color1 = ["#1B5E48","#B6BFBC"];
var color2 = ["#1B455E","#B6BFBC"];
var color3 = ["#BFA2A7", "#ADBFA2", "#A2A3BF", "#B6BFBC"];
var outerRadius = pie_w / 2;
var innerRadius = 0;
var arc = d3.svg.arc()
                .innerRadius(innerRadius)
                .outerRadius(outerRadius-10);
var svgPie1 = d3.select("#pieDiv1")
                .append("svg")
                .attr("width", pie_w)
                .attr("height", pie_h);
var svgPie2 = d3.select("#pieDiv2")
                .append("svg")
                .attr("width", pie_w)
                .attr("height", pie_h);

var createPies = function(){

  var drawPie = function(pie_object, color){

    var pieArcs = pie_object.selectAll("g.arc")
                  .data(pie(mockdataset))
                  .enter()
                  .append("g")
                  .attr("class","arc")
                  .attr("transform", "translate(" + outerRadius + ", " + outerRadius + ")");
    pieArcs.append("path")
                  .each(function(d) { this._current = d; })
                  .attr("d",arc)
                  .attr("fill", function(d, i) {
                    return color[i];
                  });
    pieArcs.append("text");

   }

   drawPie.updatePie = function(pie_object,adm_id,year_id,attr1,attr2) {
    var selectedTableYear = tables[year_id];
    var selectedRowAdm = selectedTableYear[adm_id-1];
    var selectedAttributes = [+selectedRowAdm[attr1], +selectedRowAdm[attr2]];
    var tot = d3.sum(selectedAttributes);
    var percentages = [(selectedAttributes[0]/tot)*100, (selectedAttributes[1]/tot)*100];

    function arcTween(a) {
      var i = d3.interpolate(this._current, a);
      this._current = i(0);
      return function(t) {
        return arc(i(t));
      };
    }

    pie_object.selectAll("g.arc")
      .data(pie(percentages)).select("text").transition().duration(750)
      .attr("transform", function(d) {
        return "translate(" + arc.centroid(d) + ")";
      })
      .attr("text-anchor", "middle")
      .tween("text", function(d) {
            var i = d3.interpolateRound(+this.textContent.replace('%', ''), d.value);
            return function(t) {
              this.textContent = i(t) + '%';
            };
          });
      pie_object.selectAll("g.arc")
      .data(pie(selectedAttributes)).select("path").transition().duration(750)
      .attrTween("d", arcTween);
  }

  drawPie(svgPie1, color1);
  drawPie(svgPie2, color2)
  return drawPie;

}

var createBarChart = function(){

  //Trend chart variables
  var width = 250, height = 150;
  var margins = {top: 10, right: 20, bottom: 20, left: 60};
  var chartwidth = width - margins.left - margins.right;
  var chartheight = height - margins.top - margins.bottom;
  var svgBarChartArea = d3.select("#barChart")
                  .append("svg")
                  .attr("width", width)
                  .attr("height", height);
  var barChart = svgBarChartArea.append("g")
                .attr("transform","translate("+margins.left + "," + margins.top + ")");
  var dataset = [0,0,0,0];
  var categories = ["Logging","Oil Palm","Wood Fiber","Outside Concessions"]
  //Scales
  var yScale = d3.scale.ordinal()
                .domain(categories)
                .rangeRoundBands([0,chartheight],0.4);
  var xScale = d3.scale.linear()
                .domain([0, 70])
                .range([0, chartwidth]);
  //Define x,y axis
  var xAxis = d3.svg.axis()
          .scale(xScale)
          .orient("bottom")
          .ticks(6);
  var yAxis = d3.svg.axis()
          .scale(yScale)
          .orient("left");

          function wrap(text, width) {

            text.each(function() {
              var text = d3.select(this);
              var string = text.text();
              if (string.length > 10) {
                  var words = text.text().split(/\s+/).reverse(),
                  word,
                  line = [],
                  lineNumber = -1.5,
                  lineHeight = 1.1, // ems
                  y = text.attr("y"),
                  dy = parseFloat(text.attr("dy")),
                  tspan = text.text(null).append("tspan").attr("x", 0).attr("y", y).attr("dy", dy + "em");
              while (word = words.pop()) {
                line.push(word);
                tspan.text(line.join(" "));
                if (tspan.node().getComputedTextLength() > width) {
                  line.pop();
                  tspan.text(line.join(" "));
                  line = [word];
                  tspan = text.append("tspan").attr("x", -10).attr("y", y).attr("dy", ++lineNumber * lineHeight + dy + "em").text(word);
                }
              }
            }
          });
        }

  //Create bar chart
  var drawChart = function(){
    barChart.selectAll("rect")
      .data(dataset)
      .enter()
      .append("rect")
      .on("mouseover", function(d,i){
      })
      .attr("fill", function(d, i) {
        return color3[i];
      })
      .attr("x", function(d, i){
        return xScale(0);
      })
      .attr("y", function(d,i){
        var x = categories[i];
        return yScale(x);
      })
      .attr("width", function(d){
          return xScale(d);
        })
      .attr("height", yScale.rangeBand());

    barChart.selectAll("text")
      .data(dataset)
      .enter()
      .append("text")
      .attr("x", function(d, i){
        return xScale(d);
      })
      .attr("y", function(d,i){
        var x = categories[i];
        return yScale(x) + 12;
      });

    barChart.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + (chartheight) + ")")
        .call(xAxis);
    barChart.append("g")
        .attr("class", "y axis")
        .call(yAxis)
        .selectAll(".tick text")
        .call(wrap, yScale.rangeBand());
    };

  drawChart.updateBarChart = function(adm_id, year_id){
    var selectedTableYear = tables[year_id];
    var selectedRowAdm = selectedTableYear[adm_id-1];
    var selected_dataset = [+selectedRowAdm.Logging, +selectedRowAdm.OilPalm, +selectedRowAdm.WoodFiber, +selectedRowAdm.OutCon]
    var total = d3.sum(selected_dataset);
    var perc = [(selected_dataset[0]/total)*100,(selected_dataset[1]/total)*100,(selected_dataset[2]/total)*100,(selected_dataset[3]/total)*100];
    console.log(perc);

    //xScale.domain([0, d3.max(selected_dataset)]).ticks(8);
    barChart.selectAll("rect")
      .data(perc)
      .transition()
      .duration(750)
      .attr("x", function(d, i){
        return xScale(0);
      })
      .attr("y", function(d,i){
        var x = categories[i];
        return yScale(x);
      })
      .attr("width", function(d){
          return xScale(d);
        })
      .attr("height", yScale.rangeBand());

    barChart.selectAll("text")
      .data(perc)
      .transition().duration(750)
      .attr("x", function(d, i){
        return xScale(d);
      })
      .attr("y", function(d,i){
        var x = categories[i];
        return yScale(x) + 12;
      })
      .tween("text", function(d) {
            var perc = d;
            var i = d3.interpolateRound(+this.textContent.replace('%', ''), perc);
            return function(t) {
              this.textContent = i(t) + '%';
            };
          });


    //Update X axis
    barChart.select(".x.axis")
        .transition()
        .duration(750)
        .call(xAxis);
    };
  drawChart();
  return drawChart;
}



loadTables();
//console.log(tables);
createMap();
var trendChart = createTrendChart();
var pies = createPies();
var barChart = createBarChart();


</script>
</body>
</html>
